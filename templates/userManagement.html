{% extends "layout.html" %}

{% block title %}ユーザー管理 | cocone{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', path='/css/userManagement.css') }}">
{% endblock %}

{% block content %}
    <h1>ユーザー管理</h1>

    <div class="management-container">
        
        <div id="management-error-msg" class="page-error-area"></div>

        <div class="control-panel">
            <div class="filters">
                <div class="filter-item">
                    <label for="class-filter">クラス：</label>
                    <div class="select-wrapper mini-select">
                        <select id="class-filter">
                            <option value=""></option>
                            {% for c in class_list %}
                            <option value="{{ c.name }}">{{ c.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="filter-item">
                    <label for="year-filter">入学年：</label>
                    <div class="select-wrapper mini-select">
                        <select id="year-filter">
                            <option value=""></option>
                            {% for y in years %}
                            <option value="{{ y }}">{{ y }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button id="delete-btn" class="action-btn btn-red">削除</button>
                <button id="add-btn" class="action-btn btn-green">追加</button>
            </div>
        </div>

        <div class="table-container">
            <table class="user-table">
                <thead>
                    <tr>
                        <th class="checkbox-col"><input type="checkbox" id="select-all"></th>
                        <th>学籍番号</th>
                        <th>メールアドレス</th>
                        <th>氏名</th>
                        <th>クラス</th>
                        <th>出席番号</th>
                        <th>入学年</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in students %}
                    <tr>
                        <td class="checkbox-col"><input type="checkbox" class="user-checkbox" value="{{ s.student_number }}"></td>
                        <td>{{ s.student_number }}</td>
                        <td>{{ s.email }}</td>
                        <td>{{ s.name }}</td>
                        <td>{{ s.homeroom_class }}</td>
                        <td>{{ s.attendance_no }}</td>
                        <td>{{ s.student_number[:4] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="add-user-modal" class="modal-overlay">
        <div class="modal-content add-modal-content">
            <h2>ユーザー追加</h2>
            
            <button class="bulk-add-btn">一括追加</button>

            <div class="modal-body">
                <div class="input-section">
                    <h3>所属情報</h3>
                    <div class="input-row">
                        <div class="input-group">
                            <label>入学年 :</label>
                            <div class="select-wrapper modal-select">
                                <select id="new-year">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>クラス :</label>
                            <div class="select-wrapper modal-select">
                                <select id="new-class">
                                    <option value="R1A2">R1A2</option>
                                    <option value="R1A3">R1A3</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>出席番号 :</label>
                            <div class="select-wrapper modal-select">
                                <select id="new-number">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <h3>本人情報</h3>
                    <div class="input-row">
                        <div class="input-group">
                            <label>学籍番号 :</label>
                            <input type="text" id="new-student-id" class="modal-input short-input">
                        </div>
                        <div class="input-group">
                            <label>氏名 :</label>
                            <input type="text" id="new-name" class="modal-input short-input">
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <h3>アカウント情報</h3>
                    <div class="input-row single-row">
                        <label>メールアドレス :</label>
                        <input type="email" id="new-email" class="modal-input long-input">
                    </div>
                    <div class="input-row single-row">
                        <label>初期パスワード :</label>
                        <input type="text" id="new-password" class="modal-input medium-input">
                        <button id="auto-pass-btn" class="auto-pass-btn">自動パスワード生成</button>
                    </div>
                </div>

                <div id="modal-error-msg" class="modal-error-area"></div>
            </div>

            <div class="modal-btn-area">
                <button id="modal-cancel-btn" class="modal-btn cancel-btn">キャンセル</button>
                <button id="modal-add-btn" class="modal-btn save-btn">追加</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', path='/js/userManagement.js') }}"></script>
{% endblock %}